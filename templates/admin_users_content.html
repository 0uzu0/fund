<style>
    .admin-users-inner h1 { font-size: 1.35rem; margin-bottom: 4px; color: var(--text-main); }
    .admin-users-inner .sub { font-size: 0.875rem; color: var(--text-dim); margin-bottom: 24px; }
    .admin-users-inner .section {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }
    .admin-users-inner .section-title { font-size: 1rem; color: var(--text-dim); margin-bottom: 16px; }
    .admin-users-inner .form-group { margin-bottom: 14px; }
    .admin-users-inner .form-group label { display: block; margin-bottom: 6px; font-size: 14px; color: var(--text-dim); }
    .admin-users-inner .form-group input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--bg);
        color: var(--text-main);
        font-size: 14px;
    }
    .admin-users-inner .form-group input:focus { outline: none; border-color: var(--accent); }
    .admin-users-inner .btn { padding: 10px 16px; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; }
    .admin-users-inner .btn-primary { background: #238636; color: #fff; }
    .admin-users-inner .btn-primary:hover { background: #2ea043; }
    .admin-users-inner .btn-danger { background: #da3633; color: #fff; padding: 6px 12px; font-size: 13px; }
    .admin-users-inner .btn-danger:hover { background: #b62324; }
    .admin-users-inner .error { color: #f85149; font-size: 13px; margin-bottom: 12px; }
    .admin-users-inner .success { color: #3fb950; font-size: 13px; margin-bottom: 12px; }
    .admin-users-inner table { width: 100%; border-collapse: collapse; }
    .admin-users-inner th, .admin-users-inner td { padding: 10px 12px; text-align: left; border-bottom: 1px solid var(--border); font-size: 14px; }
    .admin-users-inner th { color: var(--text-dim); font-weight: 500; }
    .admin-users-inner .user-list-empty { color: var(--text-dim); font-size: 14px; padding: 16px 0; }
    .admin-users-inner .badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; background: #21262d; color: var(--text-dim); }
    .admin-users-inner .badge-admin { background: #238636; color: #fff; }
</style>
<div class="admin-users-inner">
    <h1>ğŸ‘¤ ç”¨æˆ·ç®¡ç†</h1>
    <p class="sub">æ–°å¢ç”¨æˆ·ï¼ˆé»˜è®¤ä¸ºæ™®é€šç”¨æˆ·ï¼‰ã€æŸ¥çœ‹ä¸åˆ é™¤å·²æœ‰ç”¨æˆ·ï¼›<a href="/admin/profile" style="color: var(--accent);">ä¿®æ”¹ç®¡ç†å‘˜è´¦å·</a></p>

    {% if error %}
    <div class="error">{{ error }}</div>
    {% endif %}
    {% if success %}
    <div class="success">{{ success }}</div>
    {% endif %}

    <div class="section">
        <div class="section-title">æ–°å¢ç”¨æˆ·</div>
        <form method="POST" action="/admin/users">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å</label>
                <input type="text" id="username" name="username" placeholder="3-20 ä¸ªå­—ç¬¦" minlength="3" maxlength="20">
            </div>
            <div class="form-group">
                <label for="password">å¯†ç </label>
                <input type="password" id="password" name="password" placeholder="è‡³å°‘ 6 ä½" minlength="6">
            </div>
            <div class="form-group">
                <label for="confirm_password">ç¡®è®¤å¯†ç </label>
                <input type="password" id="confirm_password" name="confirm_password" placeholder="å†æ¬¡è¾“å…¥å¯†ç " minlength="6">
            </div>
            <button type="submit" class="btn btn-primary">åˆ›å»ºç”¨æˆ·</button>
        </form>
    </div>

    <div class="section">
        <div class="section-title">å·²æœ‰ç”¨æˆ·</div>
        {% if users %}
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ç”¨æˆ·å</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.id }}</td>
                    <td>
                        {{ u.username }}
                        {% if u.is_admin %}<span class="badge badge-admin">ç®¡ç†å‘˜</span>{% endif %}
                    </td>
                    <td>{{ u.created_at or '-' }}</td>
                    <td>
                        {% if not u.is_admin and u.username != current_username %}
                        <button type="button" class="btn btn-danger btn-delete" data-user-id="{{ u.id }}" data-username="{{ u.username }}">åˆ é™¤</button>
                        {% else %}
                        <span style="color: var(--text-dim); font-size: 13px;">â€”</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="user-list-empty">æš‚æ— ç”¨æˆ·</div>
        {% endif %}
    </div>
</div>

<script>
(function() {
    document.querySelectorAll('.btn-delete').forEach(function(btn) {
        btn.addEventListener('click', function() {
            var username = this.getAttribute('data-username');
            if (!confirm('ç¡®å®šè¦åˆ é™¤ç”¨æˆ·ã€Œ' + username + 'ã€å—ï¼Ÿå…¶åŸºé‡‘æ•°æ®å°†ä¸€å¹¶åˆ é™¤ã€‚')) return;
            var userId = this.getAttribute('data-user-id');
            fetch('/api/admin/delete-user', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: parseInt(userId, 10) })
            })
            .then(function(r) { return r.json(); })
            .then(function(res) {
                if (res.success) { alert(res.message); location.reload(); }
                else { alert(res.message || 'åˆ é™¤å¤±è´¥'); }
            })
            .catch(function(e) { alert('è¯·æ±‚å¤±è´¥: ' + e.message); });
        });
    });
})();
</script>
